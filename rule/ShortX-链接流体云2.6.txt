{
  "facts": [{
    "@type": "type.googleapis.com/ClipboardContentChanged",
    "tag": "剪切板",
    "customContextDataKey": {
    },
    "id": "F-2917ee9d-5224-4cc1-8efe-4960216eb9a3"
  }, {
    "@type": "type.googleapis.com/OnMenuActionTrigger",
    "tag": "选中",
    "customContextDataKey": {
    },
    "id": "F-782fde45-ccb3-437f-9b99-a8437664b8a9"
  }],
  "actions": [{
    "@type": "type.googleapis.com/IfThenElse",
    "If": [{
      "@type": "type.googleapis.com/RequireFactTag",
      "tag": "剪切板",
      "customContextDataKey": {
      },
      "id": "C-f89e76f4-6110-4354-8c97-619fb1ed8a7c"
    }],
    "IfActions": [{
      "@type": "type.googleapis.com/ReplaceRegex",
      "string": "{clipboardContent}",
      "regex": "\\{|\\}|`|\\\\",
      "replacement": " ",
      "customContextDataKey": {
      },
      "id": "A-4c8ee740-4d22-4407-9a61-d169e4f38585"
    }],
    "ElseActions": [{
      "@type": "type.googleapis.com/ReplaceRegex",
      "string": "{selectedText}",
      "regex": "\\{|\\}|`|\\\\",
      "replacement": " ",
      "customContextDataKey": {
      },
      "id": "A-4c8ee740-4d22-4407-9a61-d169e4f38585"
    }],
    "customContextDataKey": {
    },
    "id": "A-1b1cbef9-1560-4492-8ce1-9df51eb69295"
  }, {
    "@type": "type.googleapis.com/ExecuteJS",
    "expression": "var input\u003d`{replaceResult}`;\nvar charnum\u003dinput.length;\n\nvar error;\nvar ruleapp;\nfunction findRandomDirWithPrefix(basePath, prefix) {\n    var File \u003d java.io.File;\n    var dir \u003d new File(basePath);\n    if (!dir.exists() || !dir.isDirectory()) {\n        return null;\n    }\n    var list \u003d dir.listFiles();\n    if (list \u003d\u003d null) {\n        return null;\n    }\n    var result \u003d null;\n    for (var i \u003d 0; i \u003c list.length; i++) {\n        var file \u003d list[i];\n        if (file.isDirectory() \u0026\u0026 file.getName().startsWith(prefix)) {\n            result \u003d file.getName();\n            break; \n        }\n    }\n    return basePath+result;\n}\n\nvar shortxpath\u003dfindRandomDirWithPrefix(\"/data/system/\", \"shortx\");\nif(charnum\u003c1000){\ntry{\nimportClass(org.json.JSONArray);\nimportClass(org.json.JSONObject);\nimportClass(org.json.JSONTokener);\nimportClass(android.os.Handler);\nimportClass(android.os.Looper);\nimportPackage(android.view);\nimportPackage(android.widget);\nimportPackage(android.content);\nimportPackage(android.graphics);\nimportClass(android.graphics.drawable.GradientDrawable);\nimportClass(android.graphics.PixelFormat);\nimportClass(android.view.WindowManager);\nimportClass(java.lang.Runnable);\nimportClass(java.lang.Thread);\nimportClass(android.app.ActivityOptions);\nimportClass(android.graphics.Rect);\nimportClass(android.graphics.Point); \nimportClass(android.view.Surface);\nimportClass(android.app.ActivityManager);\nimportClass(android.content.pm.PackageManager);\nimportClass(android.os.UserHandle); \nimportClass(android.net.Uri);\nimportClass(Packages.tornaco.apps.shortx.core.proto.action.ShellCommand);\nimportClass(Packages.tornaco.apps.shortx.core.proto.action.WriteClipboard);\nimportClass(android.view.Gravity);\nimportClass(android.view.MotionEvent);\nimportClass(android.util.DisplayMetrics);\nimportClass(android.content.Context);importClass(java.io.FileReader);\nimportClass(java.io.BufferedReader);\nvar windowManager \u003d context.getSystemService(Context.WINDOW_SERVICE);\nvar metrics \u003d new DisplayMetrics();\n    windowManager.getDefaultDisplay().getMetrics(metrics);\n    var screenWidth \u003d metrics.widthPixels;\n    var screenHeight \u003d metrics.heightPixels;\n\nfunction readJsonFile(filePath) {\nvar reader \u003d new BufferedReader(new FileReader(filePath));\nvar sb \u003d new java.lang.StringBuilder();\nvar line;\nvar start \u003d false;\n\nwhile ((line \u003d reader.readLine()) !\u003d null) {  \n    var trimmed \u003d line.trim();  \n    if (!start) {  \n        if (trimmed.startsWith(\"{\") || trimmed.startsWith(\"[\")) {  \n            start \u003d true;  \n        } else {  \n            continue;   \n        }  \n    }  \n    sb.append(line);  \n}  \n\nreader.close();  \nvar jsonText \u003d String(sb.toString());  \nreturn JSON.parse(jsonText);\n\n}\nconfig\u003dreadJsonFile(shortxpath+\"/data/copylinkopenapp/config.json\")\nfunction writeConfigToFile(filePath, config) {\n    try {\n        var writer \u003d new java.io.FileWriter(filePath);\n        var bufferedWriter \u003d new java.io.BufferedWriter(writer);\n        var jsonString \u003d JSON.stringify(config, null, 2);\n        bufferedWriter.write(`一.配置版本：\n2.2\n二.字段解释：\ndjym：顶级域名列表\nemail：邮箱关键词列表\ntqm：提取码关键词列表\nhttpsonly：仅https可用的链接关键词列表（链接无请求头时使用）\nblacklist：链接黑名单关键词列表(注意是链接内的关键词，不是包名)\nxcpz:小窗的大小与位置配置，从左到右依次为竖屏高度 横屏高度 宽高比 竖屏左侧留空 横屏左侧留空 竖屏上侧留空 横屏上侧留空\nxccs：可触发小窗的Windowsmode值，coloros为100(会自动识别，旧版本可能不能识别需要修改为100)，米，类原生为5\nxswz：显示位置（顶部，底部）\nwzpy:位置偏移(向上偏移减小值向下偏移增加值)\nxscs：显示超时时长，超过设定毫秒数无动作浮窗消失\nbrowser:浏览器包名(填自动表示自动识别)\nallowchar:允许出现在链接中的字符\n\n三.配置：\\n`+jsonString);\n\n        bufferedWriter.close();\n    } catch (e) {}\n}\n\nfunction showStringListEditor(defaultValues,listname, callback) {\n    var result \u003d null;\n    function runOnUiThread(fn) {\n        new Handler(Looper.getMainLooper()).post(new Runnable({ run: fn }));\n    }\n    runOnUiThread(function () {\n        var wm \u003d context.getSystemService(Context.WINDOW_SERVICE);\n        var layout \u003d new LinearLayout(context);\n        layout.setOrientation(LinearLayout.VERTICAL);\n        layout.setPadding(40, 40, 40, 40);\n        layout.setBackgroundColor(android.graphics.Color.parseColor(\"#FF2E2E2E\"));\n        var title \u003d new TextView(context);\n        title.setText(listname);\n        title.setTextColor(android.graphics.Color.WHITE);\n        title.setTextSize(20);\n        title.setGravity(android.view.Gravity.CENTER);\n        title.setPadding(0, 0, 0, 30);\n        layout.addView(title);\n        var scrollView \u003d new ScrollView(context);\n        var scrollParams \u003d new LinearLayout.LayoutParams(-1, dip2px(400)); \n        scrollView.setLayoutParams(scrollParams);\n        var container \u003d new LinearLayout(context);\n        container.setOrientation(LinearLayout.VERTICAL);\n        container.setPadding(0, 10, 0, 10);\n        scrollView.addView(container);\n        layout.addView(scrollView); \n        var inputItems \u003d [];\n        function addInputItem(text) {\n            var itemLayout \u003d new LinearLayout(context);\n            itemLayout.setOrientation(LinearLayout.HORIZONTAL);\n            itemLayout.setPadding(0, 10, 0, 10);\n            var et \u003d new EditText(context);\n            et.setText(text || \"\");\n            et.setTextColor(android.graphics.Color.WHITE);\n            et.setHintTextColor(android.graphics.Color.GRAY);\n            et.setBackgroundColor(android.graphics.Color.parseColor(\"#33FFFFFF\"));\n            et.setPadding(20, 20, 20, 20);\n            et.setLayoutParams(new LinearLayout.LayoutParams(0, -2, 1));\n            et.setInputType(android.text.InputType.TYPE_CLASS_TEXT);\n            var delBtn \u003d new TextView(context);\n            delBtn.setText(\"✕\");\n            delBtn.setTextSize(18);\n            delBtn.setTextColor(android.graphics.Color.LTGRAY);\n            delBtn.setPadding(30, 20, 30, 20);\n            delBtn.setGravity(android.view.Gravity.CENTER);\n\n            delBtn.setOnClickListener(new View.OnClickListener({\n                onClick: function () {\n                    container.removeView(itemLayout);\n                    inputItems \u003d inputItems.filter(function (item) {\n                        return item !\u003d\u003d et;\n                    });\n                }\n            }));\n            itemLayout.addView(et);\n            itemLayout.addView(delBtn);\n            container.addView(itemLayout);\n            inputItems.push(et);\n        }\n        for (var i \u003d 0; i \u003c defaultValues.length; i++) {\n            addInputItem(defaultValues[i]);\n        }\n        var addBtn \u003d new TextView(context);\n        addBtn.setText(\"＋ 新建\");\n        addBtn.setTextSize(16);\n        addBtn.setTextColor(android.graphics.Color.WHITE);\n        addBtn.setPadding(20, 20, 20, 20);\n        addBtn.setGravity(android.view.Gravity.CENTER);\n        var addBg \u003d new android.graphics.drawable.GradientDrawable();\n        addBg.setColor(android.graphics.Color.parseColor(\"#3344FF44\"));\n        addBg.setCornerRadius(20);\n        addBtn.setBackground(addBg);\n        var addParams \u003d new LinearLayout.LayoutParams(-1, -2);\n        addParams.setMargins(0, 30, 0, 10);\n        addBtn.setLayoutParams(addParams);\n        addBtn.setOnClickListener(new View.OnClickListener({\n            onClick: function () {\n                addInputItem(\"\");\n            }\n        }));\n        layout.addView(addBtn);\n        var confirmBtn \u003d new TextView(context);\n        confirmBtn.setText(\"✔ 确认\");\n        confirmBtn.setTextSize(16);\n        confirmBtn.setTextColor(android.graphics.Color.WHITE);\n        confirmBtn.setPadding(30, 20, 30, 20);\n        confirmBtn.setGravity(android.view.Gravity.CENTER);\n\n        var confirmBg \u003d new android.graphics.drawable.GradientDrawable();\n        confirmBg.setColor(android.graphics.Color.parseColor(\"#4466CCFF\"));\n        confirmBg.setCornerRadius(30);\n        confirmBtn.setBackground(confirmBg);\n        var confirmParams \u003d new LinearLayout.LayoutParams(-1, -2);\n        confirmParams.setMargins(0, 10, 0, 0);\n        confirmBtn.setLayoutParams(confirmParams);\n        confirmBtn.setOnClickListener(new View.OnClickListener({\n            onClick: function () {\n                result \u003d [];\n                for (var i \u003d 0; i \u003c inputItems.length; i++) {\n                    result.push(String(inputItems[i].getText()));\n                }\n                try { wm.removeView(layout); } catch (e) {}\n                if (callback) {\n                    callback(result);\n                }\n            }\n        }));\n        layout.addView(confirmBtn);\n        var params \u003d new android.view.WindowManager.LayoutParams(\n            dip2px(360), -2,\n            android.view.WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY,\n            android.view.WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE |\n            android.view.WindowManager.LayoutParams.FLAG_LAYOUT_IN_SCREEN,\n            android.graphics.PixelFormat.TRANSLUCENT\n        );\n        params.gravity \u003d android.view.Gravity.TOP;\n        wm.addView(layout, params);\nlayout.post(function () {\n    params.flags \u003d params.flags \u0026 ~android.view.WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE;\n    wm.updateViewLayout(layout, params);\n\n    if (inputItems.length \u003e 0) {\n        inputItems[0].requestFocus();\n        var imm \u003d context.getSystemService(Context.INPUT_METHOD_SERVICE);\n        imm.showSoftInput(inputItems[0], android.view.inputmethod.InputMethodManager.SHOW_IMPLICIT);\n    }\n});\n    });\n    function dip2px(dp) {\n        var scale \u003d context.getResources().getDisplayMetrics().density;\n        return Math.floor(dp * scale + 0.7);\n    }\n}\nfunction getScreenWidth(context) {\n    var metrics \u003d new DisplayMetrics();\n    var wm \u003d context.getSystemService(Context.WINDOW_SERVICE);\n    wm.getDefaultDisplay().getMetrics(metrics);\n    return String(metrics.widthPixels);\n}\nfunction showsettingsui() {\n    var result \u003d null;\n    function runOnUiThread(fn) {\n        new Handler(Looper.getMainLooper()).post(new Runnable({ run: fn }));\n    }\n    runOnUiThread(function () {\n        try {\n            wm \u003d context.getSystemService(Context.WINDOW_SERVICE);\n            var outerLayout \u003d new LinearLayout(context);\n            outerLayout.setOrientation(LinearLayout.VERTICAL);\n            outerLayout.setBackgroundColor(android.graphics.Color.parseColor(\"#FF2E2E2E\"));\n            outerLayout.setPadding(40, 40, 40, 40);\n            var titleView \u003d new TextView(context);\n            titleView.setText(\"指令设置\");\n            titleView.setTextSize(20);\n            titleView.setTypeface(null, android.graphics.Typeface.BOLD);\n            titleView.setTextColor(android.graphics.Color.WHITE);\n            titleView.setGravity(android.view.Gravity.CENTER);\n            titleView.setPadding(0, 0, 0, 30);\n            outerLayout.addView(titleView);\n            var scrollView \u003d new ScrollView(context);\n            scrollView.setFillViewport(true);\n            scrollView.setLayoutParams(new LinearLayout.LayoutParams(-1, 0, 1)); \n            var scrollContent \u003d new LinearLayout(context);\n            scrollContent.setOrientation(LinearLayout.VERTICAL);\n            scrollContent.setPadding(0, 0, 0, 0);\n            scrollView.addView(scrollContent);\n            outerLayout.addView(scrollView); \n            var menuTitles \u003d [\n                \"编辑顶级域名列表\",\n                \"编辑电子邮箱列表\",\n                \"编辑仅HTTPS可用列表\",\n                \"编辑提取码关键词列表\",\n                \"编辑黑名单关键词列表\"\n            ];\n\n            for (var i \u003d 0; i \u003c menuTitles.length; i++) {\n                var menuLayout \u003d new LinearLayout(context);\n                menuLayout.setOrientation(LinearLayout.HORIZONTAL);\n                menuLayout.setGravity(android.view.Gravity.CENTER_VERTICAL);\n\n                var menuText \u003d new TextView(context);\n                menuText.setText(menuTitles[i]);\n                menuText.setTextSize(16);\n                menuText.setTextColor(android.graphics.Color.WHITE);\n                menuText.setTypeface(null, android.graphics.Typeface.BOLD);\n                menuText.setPadding(20, 20, 20, 20);\n                menuText.setLayoutParams(new LinearLayout.LayoutParams(0, -2, 1));\n                var arrow \u003d new TextView(context);\n                arrow.setText(\"＞\");\n                arrow.setTextSize(20);\n                arrow.setTextColor(android.graphics.Color.LTGRAY);\n                arrow.setPadding(0, 20, 20, 20);\n                menuLayout.addView(menuText);\n                menuLayout.addView(arrow);\n                var menuBg \u003d new android.graphics.drawable.GradientDrawable();\n                menuBg.setColor(android.graphics.Color.parseColor(\"#33FFFFFF\"));\n                menuBg.setCornerRadius(20);\n                menuLayout.setBackground(menuBg);\n                var menuParams \u003d new LinearLayout.LayoutParams(-1, -2);\n                menuParams.setMargins(0, 10, 0, 10);\n                menuLayout.setLayoutParams(menuParams);\n                scrollContent.addView(menuLayout);\n                (function(index) {\n                    menuLayout.setOnClickListener(new View.OnClickListener({\n                        onClick: function () {\n                            try { wm.removeView(outerLayout); } catch (e) {}\n                            var listData \u003d [\n                                config.djym,\n                                config.email,\n                                config.httpsonly,\n                                config.tqm,\n                                config.blacklist\n                            ];\n                            new Handler(Looper.getMainLooper()).post(new Runnable({\n                                run: function () {\n                                    showStringListEditor(listData[index],menuTitles[index] ,function (res) {\n                                        if (index \u003d\u003d\u003d 0) config.djym \u003d res;\n                                        else if (index \u003d\u003d\u003d 1) config.email \u003d res;\n                                        else if (index \u003d\u003d\u003d 2) config.httpsonly \u003d res;\n                                        else if (index \u003d\u003d\u003d 3) config.tqm \u003d res;\n                                        else if (index \u003d\u003d\u003d 4) config.blacklist \u003d res;\n                                        showsettingsui(); \n                                    });\n                                }\n                            }));\n                        }\n                    }));\n                })(i);\n            }\n            var inputs \u003d [];\n            var messagelist \u003d [\n                \"小窗配置：\\n竖屏高度\",\n                \"横屏高度\",\n                \"宽高比\",\n                \"竖屏左侧留空\",\n                \"横屏左侧留空\",\n                \"竖屏上侧留空\",\n                \"横屏上侧留空\",\n                \"小窗参数\",\n                \"流体云配置：\\n流体云位置(顶部/底部)\",\n                \"流体云位置偏移(上减下加)\",\n                \"流体云显示超时(ms)\",\n                \"其他：\\n浏览器包名\",\n                \"允许出现在链接中的字符\"\n            ];\n            var defaultValues \u003d config.xcpz.concat([config.xccs, config.xswz, config.wzpy, config.xscs,config.browser,config.allowchar]);\n            var firstInput \u003d null;\n\n            for (var i \u003d 0; i \u003c messagelist.length; i++) {\n                var label \u003d new TextView(context);\n                label.setText(messagelist[i]);\n                label.setTextColor(android.graphics.Color.LTGRAY);\n                label.setPadding(10, 15, 10, 5);\n                scrollContent.addView(label);\n                var et \u003d new EditText(context);\n                et.setHint(\"请输入内容\");\n                et.setText(String(defaultValues[i]));\n                et.setTextColor(android.graphics.Color.WHITE);\n                et.setHintTextColor(android.graphics.Color.GRAY);\n                et.setBackgroundColor(android.graphics.Color.parseColor(\"#33FFFFFF\"));\n                et.setPadding(20, 20, 20, 20);\n                et.setLayoutParams(new LinearLayout.LayoutParams(-1, -2));\n                et.setInputType(android.text.InputType.TYPE_CLASS_TEXT);\n                scrollContent.addView(et);\n                inputs.push(et);\n                if (i \u003d\u003d\u003d 0) firstInput \u003d et;\n            }\n            var confirmBtn \u003d new TextView(context);\n            confirmBtn.setText(\"确定\");\n            confirmBtn.setTextSize(16);\n            confirmBtn.setTextColor(android.graphics.Color.WHITE);\n            confirmBtn.setGravity(android.view.Gravity.CENTER);\n            confirmBtn.setPadding(30, 20, 30, 20);\n            var btnBg \u003d new android.graphics.drawable.GradientDrawable();\n            btnBg.setColor(android.graphics.Color.parseColor(\"#44FFFFFF\"));\n            btnBg.setCornerRadius(30);\n            confirmBtn.setBackground(btnBg);\n            var btnParams \u003d new LinearLayout.LayoutParams(-2, -2);\n            btnParams.gravity \u003d android.view.Gravity.END;\n            btnParams.setMargins(0, 30, 0, 0);\n            confirmBtn.setLayoutParams(btnParams);\n            outerLayout.addView(confirmBtn);\n            confirmBtn.setOnClickListener(new View.OnClickListener({\n                onClick: function () {\n                    result \u003d [];\n                    for (var i \u003d 0; i \u003c inputs.length; i++) {\n                        result.push(String(inputs[i].getText()));\n                    }\n                    config.xcpz \u003d [\n                        parseInt(result[0]), \n                        parseInt(result[1]), \n                        parseFloat(result[2]), \n                        parseInt(result[3]), \n                        parseInt(result[4]), \n                        parseInt(result[5]), \n                        parseInt(result[6])]; \n                        config.xccs\u003dparseInt(result[7]); \n                        config.xswz\u003dresult[8];\n                        config.wzpy\u003dparseInt(result[9]);\n                        config.xscs\u003dparseInt(result[10]);\n                        config.browser\u003dresult[11];\n                        config.allowchar\u003dresult[12];\n                    var configPath \u003d shortxpath + \"/data/copylinkopenapp/config.json\";\n                    writeConfigToFile(configPath, config);\n                    try { wm.removeView(outerLayout); } catch (e) {}\n                }\n            }));\n            var params \u003d new android.view.WindowManager.LayoutParams(\n                parseInt(screenWidth*0.9), parseInt(screenHeight*0.6),\n                android.view.WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY,\n                android.view.WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL |\n                android.view.WindowManager.LayoutParams.FLAG_LAYOUT_IN_SCREEN,\n                android.graphics.PixelFormat.TRANSLUCENT\n            );\n            params.gravity \u003d android.view.Gravity.TOP;\n            wm.addView(outerLayout, params);\n        } catch (e) {}\n    });\n}\nfunction showFileEditorUI(filePath) {\n    function runOnUiThread(fn) {\n        new Handler(Looper.getMainLooper()).post(new Runnable({ run: fn }));\n    }\n    runOnUiThread(function () {\n        var wm \u003d context.getSystemService(Context.WINDOW_SERVICE);\n\n        var layout \u003d new LinearLayout(context);\n        layout.setOrientation(LinearLayout.VERTICAL);\n        layout.setPadding(40, 40, 40, 40);\n        layout.setBackgroundColor(android.graphics.Color.parseColor(\"#FF2E2E2E\"));\n\n        var title \u003d new TextView(context);\n        title.setText(\"规则编辑器(规则在下面)\");\n        title.setTextSize(20);\n        title.setTextColor(android.graphics.Color.WHITE);\n        title.setGravity(android.view.Gravity.CENTER);\n        title.setPadding(0, 0, 0, 30);\n        layout.addView(title);\n        var scrollView \u003d new ScrollView(context);\n        var scrollParams \u003d new LinearLayout.LayoutParams(-1, dip2px(400));\n        scrollView.setLayoutParams(scrollParams);\n        var input \u003d new EditText(context);\n        input.setTextColor(android.graphics.Color.WHITE);\n        input.setHint(\"请输入内容...\");\n        input.setHintTextColor(android.graphics.Color.GRAY);\n        input.setBackgroundColor(android.graphics.Color.parseColor(\"#33FFFFFF\"));\n        input.setPadding(20, 20, 20, 20);\n        input.setMinHeight(dip2px(300));\n        input.setGravity(android.view.Gravity.TOP);\n        input.setInputType(android.text.InputType.TYPE_CLASS_TEXT | android.text.InputType.TYPE_TEXT_FLAG_MULTI_LINE);\n        input.setSingleLine(false);\n        input.setHorizontallyScrolling(false);\n        try {\n            var f \u003d new java.io.File(filePath);\n            if (f.exists()) {\n                var br \u003d new java.io.BufferedReader(new java.io.FileReader(f));\n                var sb \u003d new java.lang.StringBuilder();\n                var line;\n                while ((line \u003d br.readLine()) !\u003d null) {\n                    sb.append(line).append(\"\\n\");\n                }\n                br.close();\n                input.setText(sb.toString());\n            }\n        } catch (e) {\n            input.setText(\"\");\n             }\n        scrollView.addView(input);\n        layout.addView(scrollView);\n        var btnLayout \u003d new LinearLayout(context);\n        btnLayout.setOrientation(LinearLayout.HORIZONTAL);\n        btnLayout.setGravity(android.view.Gravity.END);\n        function makeBtn(text, bgColor, callback) {\n            var btn \u003d new TextView(context);\n            btn.setText(text);\n            btn.setTextColor(android.graphics.Color.WHITE);\n            btn.setTextSize(16);\n            btn.setPadding(40, 20, 40, 20);\n            btn.setGravity(android.view.Gravity.CENTER);\n            var bg \u003d new android.graphics.drawable.GradientDrawable();\n            bg.setColor(android.graphics.Color.parseColor(bgColor));\n            bg.setCornerRadius(20);\n            btn.setBackground(bg);\n            btn.setOnClickListener(new View.OnClickListener({ onClick: callback }));\n            var params \u003d new LinearLayout.LayoutParams(-2, -2);\n            params.setMargins(20, 40, 0, 0);\n            btn.setLayoutParams(params);\n            return btn;\n        }\n        var cancelBtn \u003d makeBtn(\"取消\", \"#FF555555\", function () {\n            try { wm.removeView(layout); } catch (e) {}\n        });\n        var saveBtn \u003d makeBtn(\"保存\", \"#FF3399FF\", function () {\n            try {\n                var writer \u003d new java.io.FileWriter(filePath, false);\n                writer.write(String(input.getText()));\n                writer.close();\n            } catch (e) {}\n            try { wm.removeView(layout); } catch (e) {}\n        });\n        btnLayout.addView(cancelBtn);\n        btnLayout.addView(saveBtn);\n        layout.addView(btnLayout);\n        var params \u003d new android.view.WindowManager.LayoutParams(\n            dip2px(360), -2,\n            android.view.WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY,\n            android.view.WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE |\n            android.view.WindowManager.LayoutParams.FLAG_LAYOUT_IN_SCREEN,\n            android.graphics.PixelFormat.TRANSLUCENT\n        );\n        params.gravity \u003d android.view.Gravity.TOP;\n        wm.addView(layout, params);\n        layout.post(function () {\n            params.flags \u003d params.flags \u0026 ~android.view.WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE;\n            wm.updateViewLayout(layout, params);\n            input.requestFocus();\n            var imm \u003d context.getSystemService(Context.INPUT_METHOD_SERVICE);\n            imm.showSoftInput(input, android.view.inputmethod.InputMethodManager.SHOW_IMPLICIT);\n        });\n    });\n    function dip2px(dp) {\n        var scale \u003d context.getResources().getDisplayMetrics().density;\n        return Math.floor(dp * scale + 0.5);\n    }\n}\nfunction readJsonFile(filePath) {\n    var reader \u003d new BufferedReader(new FileReader(filePath));\n    var sb \u003d new java.lang.StringBuilder();\n    var line;\n    var start \u003d false;\n\n    while ((line \u003d reader.readLine()) !\u003d null) {\n        var trimmed \u003d line.trim();\n        if (!start) {\n            if (trimmed.startsWith(\"{\") || trimmed.startsWith(\"[\")) {\n                start \u003d true;\n            } else {\n                continue; \n            }\n        }\n        sb.append(line);\n    }\n\n    reader.close();\n    var jsonText \u003d String(sb.toString());\n    return JSON.parse(jsonText);\n}\n\nfunction contains(str, keyword) {\n  if (str \u003d\u003d null || keyword \u003d\u003d null || keyword \u003d\u003d\u003d \"\") {\n    return false;\n  }\n\n  var escaped \u003dString( keyword).replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, \"\\\\$\u0026\");\n  var reg \u003d new RegExp(escaped);\n  return reg.test(str);}\n  \n\nfunction getopenapp(url) {\n\n  var pm \u003d context.getPackageManager();\n  var intent \u003d new Intent(Intent.ACTION_VIEW);\n  intent.setData(Uri.parse(url));\n\n  var resolveInfos \u003d pm.queryIntentActivities(intent, PackageManager.MATCH_DEFAULT_ONLY);\n\n  var packages \u003d [];\n  for (var i \u003d 0; i \u003c resolveInfos.size(); i++) {\n    var ri \u003d resolveInfos.get(i);\n    if (ri.activityInfo !\u003d null) {\n      packages.push(ri.activityInfo.packageName);\n    }\n  }\n  var uniquePackages \u003d Array.from(new java.util.HashSet(packages));\n  var filtered \u003d [];\n  for (var i \u003d 0; i \u003c uniquePackages.length; i++) {\n    var p \u003d uniquePackages[i];\n    if (String(p) !\u003d\u003d realdefaultBrowser) {\n      filtered.push(p);\n    }\n  }\n  if (filtered.length \u003d\u003d\u003d 0 \u0026\u0026 realdefaultBrowser !\u003d null) {\n    filtered.push(defaultBrowser);\n  }\nfiltered \u003d filtered.map(function(item) {\n  return String(item);\n});\n  return filtered;\n}\nfunction getScreenWidth(context) {\n    var metrics \u003d new DisplayMetrics();\n    var wm \u003d context.getSystemService(Context.WINDOW_SERVICE);\n    wm.getDefaultDisplay().getMetrics(metrics);\n    return String(metrics.widthPixels);\n}\n\n\nfunction getDefaultBrowserPackageName(context) {\n  var intent \u003d new Intent(Intent.ACTION_VIEW);\n  intent.setData(Uri.parse(\"http://\"));\n\n  var pm \u003d context.getPackageManager();\n  var resolveInfo \u003d pm.resolveActivity(intent, 65536);\n\n  if (resolveInfo !\u003d null \u0026\u0026 resolveInfo.activityInfo !\u003d null) {\n    return String(resolveInfo.activityInfo.packageName);\n  }\n  return null;\n}\nfunction showFloatingPrompt(opts) {\n    var result \u003d null;\n    var timeout \u003d opts.timeout || 3000;\n\n    function runOnUiThread(fn) {\n        new Handler(Looper.getMainLooper()).post(new Runnable({ run: fn }));\n    }\n\n    runOnUiThread(function () {\n        var wm \u003d context.getSystemService(Context.WINDOW_SERVICE);\n        var pm \u003d context.getPackageManager();\n\n        var layout \u003d new LinearLayout(context);\n        layout.setOrientation(LinearLayout.HORIZONTAL);\n        layout.setPadding(30, 30, 30, 30);\n        layout.setGravity(Gravity.CENTER_VERTICAL);\n\n        var bg \u003d new GradientDrawable();\n        bg.setColor(Color.parseColor(\"#DD1F1F1F\"));\n        bg.setCornerRadius(60);\n        layout.setBackground(bg);\n\n        var iconView \u003d new ImageView(context);\n        var iconSize \u003d 130;\n        var iconParams \u003d new LinearLayout.LayoutParams(iconSize, iconSize);\n        iconParams.setMargins(0, 0, 30, 0);\n        iconView.setLayoutParams(iconParams);\n\n        try {\n            var icon \u003d pm.getApplicationIcon(opts.pkg);\n            iconView.setImageDrawable(icon);\n        } catch (e) {\n            iconView.setImageResource(android.R.drawable.sym_def_app_icon);\n        }\n\n        layout.addView(iconView);\n\n        var textLayout \u003d new LinearLayout(context);\n        textLayout.setOrientation(LinearLayout.VERTICAL);\n        textLayout.setLayoutParams(new LinearLayout.LayoutParams(0, -2, 1));\n\n        var title \u003d new TextView(context);\n        title.setText(opts.title || \"打开应用\");\n        title.setTextSize(18);\n        title.setTypeface(null, android.graphics.Typeface.BOLD);\n        title.setTextColor(Color.WHITE);\n\n        var subtitle \u003d new TextView(context);\n        subtitle.setText(opts.subtitle || \"\");\n        subtitle.setTextSize(14);\n        subtitle.setTextColor(Color.LTGRAY);\n\n        textLayout.addView(title);\n        textLayout.addView(subtitle);\n        layout.addView(textLayout);\n\n        var btn \u003d new TextView(context);\n        btn.setText(opts.buttonText || \"浮窗打开\");\n        btn.setTextSize(14);\n        btn.setTextColor(Color.WHITE);\n        btn.setGravity(Gravity.CENTER);\n        btn.setPadding(30, 20, 30, 20);\n\n        var btnBg \u003d new GradientDrawable();\n        btnBg.setColor(Color.parseColor(\"#44FFFFFF\"));\n        btnBg.setCornerRadius(60);\n        btn.setBackground(btnBg);\n\n        var btnParams \u003d new LinearLayout.LayoutParams(-2, -2);\n        btnParams.setMargins(30, 0, 0, 0);\n        btn.setLayoutParams(btnParams);\n        layout.addView(btn);\n\n        layout.setOnClickListener(new View.OnClickListener({\n            onClick: function () {\n                result \u003d opts.resultOnClick || \"click\";\n                try { wm.removeView(layout); } catch (e) {}\n            }\n        }));\n\n        btn.setOnClickListener(new View.OnClickListener({\n            onClick: function () {\n                result \u003d opts.resultOnButton || \"button\";\n                try { wm.removeView(layout); } catch (e) {}\n            }\n        }));\n\n        var downY \u003d 0;\n\n        layout.setOnTouchListener(new View.OnTouchListener({\n    onTouch: function (v, event) {\n        switch (event.getAction()) {\n            case MotionEvent.ACTION_DOWN:\n                downY \u003d event.getRawY();\n                return false;\n            case MotionEvent.ACTION_UP:\n                var upY \u003d event.getRawY();\n                if (downY - upY \u003e 100) {\n                    result \u003d opts.resultOnSwipe || \"swipe_close\";\n                    try { wm.removeView(layout); } catch (e) {}\n                    return true;\n                } else if (upY - downY \u003e 100) {\n                    result \u003d opts.resultOnSwipeDown || \"swipe_down\";\n                    try { wm.removeView(layout); } catch (e) {}\n                    return true;\n                }\n                return false;\n        }\n        return false;\n    }\n}));\n\n        var params \u003d new WindowManager.LayoutParams(\n            parseInt(getScreenWidth(context)*0.9), -2,\n            WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY,\n            WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE | WindowManager.LayoutParams.FLAG_LAYOUT_IN_SCREEN,\n            PixelFormat.TRANSLUCENT\n        );\n        params.gravity \u003d opts.gravity || (Gravity.BOTTOM | Gravity.CENTER_HORIZONTAL);\n        params.x \u003d opts.x || 0;\n        params.y \u003d opts.y || 150;\n        wm.addView(layout, params);\n\n        new Thread(new Runnable({\n            run: function () {\n                Thread.sleep(timeout);\n                runOnUiThread(function () {\n                    if (result \u003d\u003d\u003d null) {\n                        result \u003d opts.resultOnTimeout || \"timeout\";\n                        try { wm.removeView(layout); } catch (e) {}\n                    }\n                });\n            }\n        })).start();\n    });\n\n    while (result \u003d\u003d\u003d null) {\n        Thread.sleep(150);\n    }\n\n    return result;\n}\nfunction showOptionsDialog(options, titleText) {\n    var result \u003d null;\n\n    function runOnUiThread(fn) {\n        new Handler(Looper.getMainLooper()).post(new Runnable({ run: fn }));\n    }\n\n    runOnUiThread(function () {\n        var pm \u003d context.getPackageManager();\n        var wm \u003d context.getSystemService(Context.WINDOW_SERVICE);\n        var layout \u003d new FrameLayout(context);\n        var isDarkMode \u003d (context.getResources().getConfiguration().uiMode\n            \u0026 android.content.res.Configuration.UI_MODE_NIGHT_MASK)\n            \u003d\u003d\u003d android.content.res.Configuration.UI_MODE_NIGHT_YES;\n\n        var shape \u003d new GradientDrawable();\n        var backgroundColor \u003d isDarkMode ? \"#343434\" : \"#FAFAFA\";\n        var textColor \u003d isDarkMode ? Color.WHITE : Color.BLACK;\n        shape.setColor(Color.parseColor(backgroundColor));\n        shape.setCornerRadius(30);\n        if (!isDarkMode) shape.setStroke(2, Color.parseColor(\"#22000000\"));\n        layout.setBackground(shape);\n\n        var displayMetrics \u003d context.getResources().getDisplayMetrics();\n        var maxWidth \u003d displayMetrics.widthPixels * 0.8;\n        var maxHeight \u003d displayMetrics.heightPixels * 0.6; \n\n        var params \u003d new WindowManager.LayoutParams(\n            WindowManager.LayoutParams.WRAP_CONTENT,\n            WindowManager.LayoutParams.WRAP_CONTENT,\n            WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY,\n            WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE | WindowManager.LayoutParams.FLAG_LAYOUT_IN_SCREEN,\n            PixelFormat.TRANSLUCENT\n        );\n        params.gravity \u003d Gravity.CENTER;\n        params.width \u003d maxWidth;\n        var scrollView \u003d new ScrollView(context);\n        var scrollParams \u003d new FrameLayout.LayoutParams(\n            FrameLayout.LayoutParams.MATCH_PARENT,\n            FrameLayout.LayoutParams.WRAP_CONTENT\n        );\n        scrollView.setLayoutParams(scrollParams);\n        var container \u003d new LinearLayout(context);\n        container.setOrientation(LinearLayout.VERTICAL);\n        var titleView \u003d new TextView(context);\n        titleView.setText(titleText || \"请选择\");\n        titleView.setTextSize(20);\n        titleView.setTextColor(textColor);\n        titleView.setGravity(Gravity.CENTER);\n        titleView.setTypeface(null, android.graphics.Typeface.BOLD);\n        titleView.setPadding(40, 40, 40, 20);\n        container.addView(titleView);\n\n        scrollView.addView(container);\n        layout.addView(scrollView);\n\n        scrollView.post(new Runnable({\n            run: function () {\n                if (scrollView.getHeight() \u003e maxHeight) {\n                    var newParams \u003d scrollView.getLayoutParams();\n                    newParams.height \u003d maxHeight;\n                    scrollView.setLayoutParams(newParams);\n                }\n            }\n        }));\n\n        function makeOptionView(item) {\n            if (typeof item \u003d\u003d\u003d \"string\") {\n                var simpleLayout \u003d new LinearLayout(context);\n                simpleLayout.setOrientation(LinearLayout.VERTICAL);\n                simpleLayout.setPadding(30, 30, 30, 30);\n\n                var labelView \u003d new TextView(context);\n                labelView.setText(item);\n                labelView.setTextSize(16);\n                labelView.setTextColor(textColor);\n                simpleLayout.addView(labelView);\n\n                simpleLayout.setOnClickListener(new View.OnClickListener({\n                    onClick: function () {\n                        result \u003d item;\n                        try { wm.removeView(layout); } catch (e) {}\n                    }\n                }));\n\n                return simpleLayout;\n            }\n\n            var itemLayout \u003d new LinearLayout(context);\n            itemLayout.setOrientation(LinearLayout.HORIZONTAL);\n            itemLayout.setPadding(30, 30, 30, 30);\n            itemLayout.setGravity(Gravity.CENTER_VERTICAL);\n\n            var iconView \u003d new ImageView(context);\n            var iconSize \u003d 96;\n            var iconParams \u003d new LinearLayout.LayoutParams(iconSize, iconSize);\n            iconParams.setMargins(0, 0, 30, 0);\n            iconView.setLayoutParams(iconParams);\n\n            if (item.pkg) {\n                try {\n                    var icon \u003d pm.getApplicationIcon(item.pkg);\n                    iconView.setImageDrawable(icon);\n                } catch (e) {\n                    iconView.setImageResource(android.R.drawable.sym_def_app_icon);\n                }\n                itemLayout.addView(iconView);\n            } else if (item.icon) {\n                var emoji \u003d new TextView(context);\n                emoji.setText(item.icon);\n                emoji.setTextSize(20);\n                emoji.setLayoutParams(iconParams);\n                itemLayout.addView(emoji);\n            } else {\n                iconView.setImageResource(android.R.drawable.sym_def_app_icon);\n                itemLayout.addView(iconView);\n            }\n\n            var textLayout \u003d new LinearLayout(context);\n            textLayout.setOrientation(LinearLayout.VERTICAL);\n\n            var title \u003d new TextView(context);\n            title.setText(item.label || item.value || \"未命名\");\n            title.setTextSize(16);\n            title.setTextColor(textColor);\n\n            var desc \u003d new TextView(context);\n            desc.setText(item.desc || \"\");\n            desc.setTextSize(13);\n            desc.setTextColor(isDarkMode ? Color.LTGRAY : Color.DKGRAY);\n\n            textLayout.addView(title);\n            textLayout.addView(desc);\n            itemLayout.addView(textLayout);\n\n            itemLayout.setOnClickListener(new View.OnClickListener({\n                onClick: function () {\n                    result \u003d item.value;\n                    try { wm.removeView(layout); } catch (e) {}\n                }\n            }));\n\n            return itemLayout;\n        }\n\n        for (var i \u003d 0; i \u003c options.length; i++) {\n            container.addView(makeOptionView(options[i]));\n        }\n\n        try {\n            wm.addView(layout, params);\n        } catch (e) {\n            result \u003d null;\n        }\n    });\n\n    while (result \u003d\u003d\u003d null) {\n        Thread.sleep(150);\n    }\n\n    return result;\n}\n\n\nfunction reversal(a) {\n    return a \u003d\u003d\u003d true ? false : true;\n}\n\nfunction ri(a) {\n    var r \u003d a.replace(\"http://\", \"\").replace(\"https://\", \"\");\n    r \u003d r.split(\" \")[0];\n    return r;\n}\n\nfunction db(a, output) {\n    for (var i \u003d 0; i \u003c output.length; i++) {\n        if (ri(output[i]) \u003d\u003d\u003d ri(a)) {\n            return false;\n        }\n    }\n    return true;\n}\n\nfunction where(a, b) {\n    var list1 \u003d [];\n    for (var i \u003d 0; i \u003c a.length; i++) {\n        if (ri(a[i]) \u003d\u003d\u003d ri(b)) {\n            list1.push(i);\n        }\n    }\n    return list1;\n}\n\nfunction huisu(list, value_to_find, list_to_find) {\n    var a \u003d where(list, value_to_find);\n    var output \u003d [];\n    for (var i \u003d 0; i \u003c a.length; i++) {\n        var pos \u003d a[i];\n        for (var j \u003d pos - 1; j \u003e\u003d 0; j--) {\n            if (!db(list[j], list_to_find)) {\n                if (list[j].split(\" \").length \u003c 2) {\n                    var yzm \u003d value_to_find.split(\":\")[1];\n                    if (yzm \u003d\u003d\u003d \"\") {\n                        yzm \u003d list[pos + 1];\n                    }\n                    yzm \u003d yzm.replace(\" \", \"\");\n                    var outputIndices \u003d where(list_to_find, list[j]);\n                    if (outputIndices.length \u003e 0) {\n                        if (!contains(list_to_find[outputIndices[0]],\"提取码:\")) {\n                            list_to_find[outputIndices[0]] \u003d list[j] + \" 提取码:\" + yzm;\n                        } else {\n                            list_to_find.push(String(list[j] + \" 提取码:\" + yzm));\n                        }\n                        break;\n                    }\n                }\n            }\n        }\n    }\n}\n\nfunction qvzi(a) {\n    for (var i \u003d 0; i \u003c Extractioncodelist.length; i++) {\n        a \u003d a.replace(new RegExp(Extractioncodelist[i], \"g\"), \" Extractioncode:\");\n    }\n    a \u003d a.replace(/\\[[^\\]]*\\]/g, \"\").trim();\n    var output \u003d \"\";\n    allowchar\u003dallowchar+\" \\n\";\n    for (var i \u003d 0; i \u003c a.length; i++) {\n        if (contains(allowchar,a[i])) {\n            output +\u003d a[i];\n        }\n    }\n    return output.trim();\n}\n\nfunction shaixuan(a) {\n    a \u003d a.replace(/http:\\/\\//g, \" http://\").replace(/https:\\/\\//g, \" https://\");\n    var duanluo \u003d a.split(/\\n|,|，|；|;|\\s+/);\n    duanluo \u003d duanluo.filter(function(token) { return token.trim() !\u003d\u003d \"\"; });\n\n    var output \u003d [];\n    var ecjc \u003d [];\n    var yzm \u003d false;\n    var Extractioncodelist \u003d [];\n\n    if (contains(a,\"Extractioncode:\")) {\n        yzm \u003d true;\n        for (var i \u003d 0; i \u003c duanluo.length; i++) {\n            if (contains(duanluo[i],\"Extractioncode:\")) {\n                if (!contains(Extractioncodelist,duanluo[i])) {\n                    Extractioncodelist.push(duanluo[i]);\n                }\n            }\n        }\n    }\n\n    for (var i \u003d 0; i \u003c dinjiyumin.length; i++) {\n        for (var j \u003d 0; j \u003c duanluo.length; j++) {\n            if (contains(duanluo[j],\".\" + dinjiyumin[i] + \"/\")\u0026\u0026 duanluo[j].length \u003e dinjiyumin[i].length + 2) {\n                if (db(duanluo[j], output)) {\n                    output.push(duanluo[j]);\n                }\n            } else if (db(duanluo[j], ecjc)) {\n                ecjc.push(duanluo[j]);\n            }\n        }\n    }\n\n    for (var i \u003d 0; i \u003c dinjiyumin.length; i++) {\n        for (var j \u003d 0; j \u003c ecjc.length; j++) {\n            if (contains(ecjc[j],\".\" + dinjiyumin[i])\u0026\u0026 ecjc[j].length \u003e dinjiyumin[i].length + 1) {\n                var suffix \u003d \".\" + dinjiyumin[i];\n                if (ecjc[j].substr(ecjc[j].length - suffix.length) \u003d\u003d\u003d suffix) {\n                    if (db(ecjc[j], output)) {\n                        var isEmail \u003d false;\n                        for (var w \u003d 0; w \u003c emaillist.length; w++) {\n                            if (contains(ecjc[j],\"@\" + emaillist[w])) {\n                                isEmail \u003d true;\n                                break;\n                            }\n                        }\n                        if (!isEmail) {\n                            output.push(ecjc[j]);\n                        }\n                    }\n                }\n            } else if ((contains(ecjc[j],\"http://\")|| contains(ecjc[j],\"https://\")) \u0026\u0026 ecjc[j].length \u003e 8 \u0026\u0026 contains(ecjc[j],\".\")) {\n                if (db(ecjc[j], output)) {\n                    output.push(ecjc[j]);\n                }\n            }\n        }\n    }\n\n    if (yzm) {\n        for (var i \u003d 0; i \u003c Extractioncodelist.length; i++) {\n            huisu(duanluo, Extractioncodelist[i], output);\n        }\n    }\n\n    return output;\n}\n\nfunction qinqiutou(a) {\n    var output \u003d [];\n    for (var i \u003d 0; i \u003c a.length; i++) {\n        var link \u003d a[i];\n        if (!contains(link,\"http://\") \u0026\u0026 !contains(link,\"https://\")) {\n            var httpLink \u003d \"http://\" + link;\n            var httpsLink \u003d \"https://\" + link;\n            if (!contains(output,httpLink) \u0026\u0026 !contains(output,httpsLink)) {\n                var useHttps \u003d false;\n                for (var j \u003d 0; j \u003c httpslist.length; j++) {\n                    if (contains(link,httpslist[j])) {\n                        useHttps \u003d true;\n                        break;\n                    }\n                }\n                output.push(useHttps ? String(httpsLink) :String( httpLink));\n            }\n        } else if (!contains(output,link)) {\n            output.push(String(link));\n        }\n    }\n    return output;\n}\n\nfunction cleanblacklist(linklist) {\n    for (var i \u003d 0; i \u003c blacklist.length; i++) {\n        for (var j \u003d 0; j \u003c linklist.length; j++) {\n            if (contains(linklist[j],blacklist[i])) {\n                linklist.splice(j, 1);\n                j--;\n            }\n        }\n    }\n    return linklist;\n}\n\nfunction main(a) {\n    var b \u003d cleanblacklist(qinqiutou(shaixuan(qvzi(a))));\n    if (b.length !\u003d\u003d 0) {\n        return b.join(\",\");\n    } else {\n        return \"No links\";\n    }\n}\n\n\n\nfunction writelocalvar(name,value){\nvar writeLocalVar \u003d Packages.tornaco.apps.shortx.core.proto.action.WriteLocalVar.newBuilder()\n                .setVarName(name)\n                .setValueAsString(value)\n                .build();\n            shortx.executeAction(writeLocalVar);\n}\nfunction getAppName(packageName) {\n    try {\n        var packageManager \u003d context.getPackageManager();\n        var applicationInfo \u003d packageManager.getApplicationInfo(packageName, 0);\n        var appName \u003d packageManager.getApplicationLabel(applicationInfo);\n        return appName;\n    } catch (e) {\n        return false;\n    }\n}\n\n\nfunction isAppinstall(pkgName) {\n    var path \u003d \"/data/data/\"+pkgName;\n    var File \u003d java.io.File;\n    var dir \u003d new File(path);\n    return dir.exists() \u0026\u0026 dir.isDirectory();\n}\n\nfunction matchrules(linkall){\nvar linkparts\u003dlinkall.split(\" 提取码:\");\nvar link\u003dString(linkparts[0]);\nif(linkparts.length\u003d\u003d2){\nvar tqm\u003dlinkparts[1]}\nvar output;\nfunction replaceAll(text, target, replacement) {\n    var pattern \u003d new RegExp(target, \"g\"); \n    return text.replace(pattern, replacement);\n}\nfunction isinlist(str,strlist){\nfor(var i\u003d0;i\u003cstrlist.length;i++){\nif (str.includes(strlist[i])){return true;}\n}\nreturn false;\n}\nvar result \u003d readJsonFile(shortxpath+\"/data/copylinkopenapp/rules.json\");\nvar isfirst\u003dtrue;\nvar withtqm\u003dtrue;\nfor (var i \u003d 0 ;i\u003cresult.length;i++){\nif(isinlist(link,result[i].tigger)){\nif(result[i].type\u003d\u003d\"url\"){if(result[i].check.includes(\"://\")){if(contains(getopenapp(result[i].check),defaultBrowser)){continue;}}else{if(!isAppinstall(result[i].check)){continue;}}\nvar jsonkeyslist\u003dObject.keys(result[i]);\nfor(var j\u003d0;j\u003cjsonkeyslist.length;j++){\nif(![\"name\",\"tigger\",\"rule\",\"type\",\"check\"].includes(jsonkeyslist[j])){\na\u003dlink.match(new RegExp(result[i][jsonkeyslist[j]]));\nif(a!\u003d\u003dnull){\nresult[i][jsonkeyslist[j]]\u003da[1]}\n}\n\n}\nresult[i].link\u003dlink;\nif(typeof tqm !\u003d\u003d \"undefined\" \u0026\u0026 tqm !\u003d\u003d null){\nresult[i].tqm\u003dtqm;}else{withtqm\u003dfalse;result[i].tqm\u003d\"\"}\nvar jsonkeys\u003dObject.keys(result[i]);\nfor(var j\u003d0;j\u003cjsonkeys.length;j++){\n\nif(![\"name\",\"tigger\",\"rule\",\"type\",\"check\"].includes(jsonkeys[j])){\nif(isfirst){\nif(withtqm){\nif(typeof result[i].rulewithtqm !\u003d\u003d \"undefined\" \u0026\u0026 result[i].rulewithtqm !\u003d\u003d null){\noutput\u003dreplaceAll(result[i].rulewithtqm,\"【\"+jsonkeys[j]+\"】\",result[i][jsonkeys[j]]);}else{output\u003dreplaceAll(result[i].rule,\"【\"+jsonkeys[j]+\"】\",result[i][jsonkeys[j]]);}}else{output\u003dreplaceAll(result[i].rule,\"【\"+jsonkeys[j]+\"】\",result[i][jsonkeys[j]]);}\nisfirst\u003dfalse;\n}else{output\u003dreplaceAll(output,\"【\"+jsonkeys[j]+\"】\",result[i][jsonkeys[j]]);\n}}\n}\nruleapp\u003dresult[i][\"name\"];\nreturn [\"url\",output];}else if(result[i].type\u003d\u003d\"pkg\"){ruleapp\u003dresult[i][\"name\"];if(!result[i].pkg.includes(\"://\")){\nif(isAppinstall(result[i].pkg)){\nreturn[\"pkg\",[result[i].pkg]];\n}else{continue;}\n}else{return[\"pkg\",getopenapp(result[i].pkg)]}}}\n}\nreturn false;}\n\nvar isrunaction\u003dfalse;\ntry{\n{factTag}\n}catch(e){\nisrunaction\u003dtrue;\n}\nif(isrunaction\u003d\u003dtrue){\nvar setaction\u003dshowOptionsDialog([\"设置指令\",\"编辑规则\",\"取消\"],\"选择操作\");\nif(setaction\u003d\u003d\"设置指令\"){\nshowsettingsui();\n}else if(setaction\u003d\u003d\"编辑规则\"){\nshowFileEditorUI(shortxpath+\"/data/copylinkopenapp/rules.json\");\n}\n}else{\nconfig\u003dreadJsonFile(shortxpath+\"/data/copylinkopenapp/config.json\")\nvar dinjiyumin\u003dconfig.djym;\nvar emaillist\u003dconfig.email;\nvar blacklist\u003dconfig.blacklist;\nvar outltywz\u003dconfig.xswz;\nvar outltywzpy\u003dconfig.wzpy;\nvar httpslist\u003dconfig.httpsonly;\nvar Extractioncodelist\u003dconfig.tqm;\nvar outxcpz\u003dconfig.xcpz;\nvar outxccs\u003dconfig.xccs;\nvar ltytimeout\u003dconfig.xscs;  \nvar defaultBrowser\u003dconfig.browser;\nvar allowchar\u003dconfig.allowchar;\nif(defaultBrowser\u003d\u003d\"自动\"){\ndefaultBrowser\u003dgetDefaultBrowserPackageName(context);\n}\nvar realdefaultBrowser \u003dgetDefaultBrowserPackageName(context);\nvar origin\u003dinput;\nvar alllinks\u003dmain(origin).split(\",\");\nif(alllinks!\u003d\"No links\"){\nvar link;\nvar linknum\u003dalllinks.length;\nif(linknum\u003e\u003d2){\nvar dgljlty;\nif(outltywz\u003d\u003d\"顶部\"){dgljlty\u003d{\n  pkg: defaultBrowser,\n  title: \"多个链接\",\n  subtitle: \"点击打开选择链接弹框\",\n  buttonText: \"选择链接\",\n  resultOnClick: true,\n  resultOnButton: true,\n  resultOnTimeout: false,\n  resultOnSwipe: false,\n  resultOnSwipeDown: true,\n  timeout: ltytimeout,\n  gravity: Gravity.TOP | Gravity.CENTER,\n  x: 0,\n  y: outltywzpy\n}}else{\ndgljlty\u003d{\n  pkg: defaultBrowser,\n  title: \"多个链接\",\n  subtitle: \"点击打开选择链接弹框\",\n  buttonText: \"选择链接\",\n  resultOnClick: true,\n  resultOnButton: true,\n  resultOnTimeout: false,\n  resultOnSwipe: true,\n  resultOnSwipeDown: false,\n  timeout: ltytimeout,\n  gravity: Gravity.BOTTOM | Gravity.CENTER,\n  x: 0,\n  y: outltywzpy\n}\n}\nvar openact;\nvar cz\u003dshowFloatingPrompt(dgljlty);\nif(cz\u003d\u003dtrue){\nalllinks.push(\"取消\");\nlink\u003dString(showOptionsDialog(alllinks,\"选择链接\"));}else{link\u003d\"取消\";}}else{link\u003dString(alllinks);}\nif(link\u003d\u003d\"取消\"){openact\u003d\"取消\";}\nmatchresult\u003dmatchrules(link)\nif(matchresult[0]\u003d\u003d\"url\"){\nvar result\u003dmatchresult[1];\nvar zdygzmz\u003dfalse;\n}else if(matchresult[0]\u003d\u003d\"pkg\"){\nvar result\u003dfalse\nvar zdygzmz\u003dmatchresult[1];\n}else{\nvar result\u003dfalse;\nvar zdygzmz\u003dfalse;\n}\n\nvar dhklist\u003d[];\nif (result !\u003d false){\nvar tzapp\u003dgetopenapp(result);\nif(tzapp\u0026\u0026tzapp.length\u003d\u003d1){\nvar tzappname\u003d[getAppName(tzapp[0])];\n}else{\nvar tzappname\u003d[];\nfor (var i\u003d0;i\u003ctzapp.length;i++){\ntzappname.push(getAppName(tzapp[i]));\n}}\nvar openapp;\n\n}\nvar zsyapp\u003dgetopenapp(link);\nif(zdygzmz!\u003dfalse){\nfor(var i\u003d0;i\u003czdygzmz.length;i++){\nif(contains(zsyapp.toString(),zdygzmz)){\nzsyapp \u003d zsyapp.filter(function(item) {\n  return !contains(zdygzmz,item);\n});}\nzsyapp\u003dzdygzmz.concat(zsyapp);\n}}\nif(tzapp!\u003dzsyapp\u0026\u0026result!\u003dfalse){\nfor (var i\u003d0;tzapp\u0026\u0026i\u003ctzapp.length;i++){\nif(tzappname!\u003dfalse){\ndhklist.push({ label: tzappname[i], desc: \"全屏\", pkg: tzapp[i], value: [\"跳转\",tzapp[i]] });\ndhklist.push({ label: tzappname[i], desc: \"小窗\", pkg: tzapp[i], value: [\"小窗跳转\",tzapp[i]] });}}\n}\nvar zsyappname;\nif(zsyapp \u003d\u003d false){\nzsyapp\u003d\"com.android.settings\";\nzsyappname\u003d[\"应用选择器\"];\n}else{if(zsyapp.length\u003d\u003d1){\nzsyappname\u003d[getAppName(zsyapp[0])];}else{\nzsyappname\u003d[];\nfor (var i\u003d0;i\u003czsyapp.length;i++){\nzsyappname.push(getAppName(zsyapp[i]));\n}\n}\n}\ndefaultBrowsername\u003dgetAppName(defaultBrowser);\n\nfor (var i\u003d0;zsyapp\u0026\u0026i\u003czsyapp.length;i++){\nif(((tzapp\u0026\u0026!contains(tzapp.toString(),zsyapp[i]))||!tzapp)\u0026\u0026zsyappname[i]!\u003dfalse){\ndhklist.push({ label: zsyappname[i], desc: \"全屏\", pkg: zsyapp[i], value: [\"自适应应用打开\",zsyapp[i]] });\ndhklist.push({ label: zsyappname[i], desc: \"小窗\", pkg: zsyapp[i], value: [\"自适应应用打开（小窗）\",zsyapp[i]] });\n}}\n\nif(!contains(zsyapp.toString(),defaultBrowser)){\ndhklist.push({ label: defaultBrowsername, desc: \"全屏\", pkg: defaultBrowser, value:[ \"浏览器打开\",defaultBrowser] });\ndhklist.push({ label: defaultBrowsername, desc: \"小窗\", pkg: defaultBrowser, value:[ \"浏览器打开（小窗）\",defaultBrowser] });}\ndhklist.push({ label: \"选择应用打开\", desc: \"全屏\", icon: \"📱\", value:[ \"选择应用打开\",\"\"] });\ndhklist.push({ label: \"复制链接\", desc: \"复制清理干净的链接和提取码\", icon: \"📋\", value: [\"复制链接\",\"\"] });\ndhklist.push({ label: \"取消\", desc: \"关闭指令窗口\", icon: \"❌\", value: [\"取消\",\"\"] });\nvar ltyxq;\nif(linknum\u003c2\u0026\u0026result!\u003dfalse\u0026\u0026tzapp!\u003dzsyapp){\nvar tzappindex\u003d0;\nif(tzappname[0]\u003d\u003dfalse){\nfor (var i\u003d1;i\u003ctzappname.length;i++){\nif(tzappname[i]!\u003dfalse){tzappindex\u003di;break;}}\n}\nif(outltywz\u003d\u003d\"顶部\"){\nltyxq\u003d{\n  pkg: tzapp[tzappindex],\n  title: \"打开\"+tzappname[tzappindex],\n  subtitle: \"点击全屏打开\"+tzappname[tzappindex],\n  buttonText: \"浮窗打开\",\n  resultOnClick: \"跳转\",\n  resultOnButton: \"小窗跳转\",\n  resultOnTimeout: \"取消\",\n  resultOnSwipe: \"取消\",\n  resultOnSwipeDown: \"choose\",\n  timeout: ltytimeout,\n  gravity: Gravity.TOP | Gravity.CENTER,\n  x: 0,\n  y: outltywzpy\n}}else{\nltyxq\u003d{\n  pkg: tzapp[tzappindex],\n  title: \"打开\"+tzappname[tzappindex],\n  subtitle: \"点击全屏打开\"+tzappname[tzappindex],\n  buttonText: \"浮窗打开\",\n  resultOnClick: \"跳转\",\n  resultOnButton: \"小窗跳转\",\n  resultOnTimeout: \"取消\",\n  resultOnSwipe: \"choose\",\n  resultOnSwipeDown: \"取消\",\n  timeout: ltytimeout,\n  gravity: Gravity.BOTTOM | Gravity.CENTER,\n  x: 0,\n  y: outltywzpy\n\n}\n}\n\n\nif(tzapp!\u003d%FrontAppPkgName%\u0026\u0026!(zsyapp\u003d\u003d%FrontAppPkgName%\u0026\u0026zsyapp!\u003drealdefaultBrowser\u0026\u0026zsyapp!\u003ddefaultBrowser)\u0026\u0026openact!\u003d\"取消\"){\nopenact\u003dshowFloatingPrompt(ltyxq);\nopenapp\u003dtzapp[0];\n}else{openact\u003d\"取消\";}\n}else if(linknum\u003c2\u0026\u0026(result\u003d\u003dfalse||(result!\u003dfalse\u0026\u0026tzapp\u003d\u003dzsyapp))\u0026\u0026openact!\u003d\"取消\"){\nvar zsyappindex\u003d0;\nif(zsyappname[0]\u003d\u003dfalse){\nfor (var i\u003d1;i\u003czsyappname.length;i++){\nif(zsyappname[i]!\u003dfalse){zsyappindex\u003di;break;}}\n}\nif(outltywz\u003d\u003d\"顶部\"){\nltyxq\u003d{\n  pkg: zsyapp[zsyappindex],\n  title: \"打开\"+zsyappname[zsyappindex],\n  subtitle: \"点击全屏打开\"+zsyappname[zsyappindex],\n  buttonText: \"浮窗打开\",\n  resultOnClick: \"自适应应用打开\",\n  resultOnButton: \"自适应应用打开（小窗）\",\n  resultOnTimeout: \"取消\",\n  resultOnSwipe: \"取消\",\n  resultOnSwipeDown: \"choose\",\n  timeout: ltytimeout,\n  gravity: Gravity.TOP | Gravity.CENTER,\n  x: 0,\n  y: outltywzpy\n}}else{\nltyxq\u003d{\n  pkg: zsyapp[zsyappindex],\n  title: \"打开\"+zsyappname[zsyappindex],\n  subtitle: \"点击全屏打开\"+zsyappname[zsyappindex],\n  buttonText: \"浮窗打开\",\n  resultOnClick: \"自适应应用打开\",\n  resultOnButton: \"自适应应用打开（小窗）\",\n  resultOnTimeout: \"取消\",\n  resultOnSwipe: \"choose\",\n  resultOnSwipeDown: \"取消\",\n  timeout: ltytimeout,\n  gravity: Gravity.BOTTOM | Gravity.CENTER,\n  x: 0,\n  y: outltywzpy\n}\n}\nif(!(zsyapp\u003d\u003d%FrontAppPkgName%\u0026\u0026zsyapp!\u003drealdefaultBrowser\u0026\u0026zsyapp!\u003ddefaultBrowser\u0026\u0026zsyapp!\u003drealdefaultBrowser)\u0026\u0026openact!\u003d\"取消\"){\nopenact\u003dshowFloatingPrompt(ltyxq);\nopenapp\u003dzsyapp[0];\n}else{openact\u003d\"取消\";}\n}else{if(openact!\u003d\"取消\"){openact\u003d\"choose\";}}\nif(openact\u003d\u003d\"choose\"){\nvar dhkresult\u003dshowOptionsDialog(dhklist,\"打开方式\");\nopenact\u003ddhkresult[0];\nopenapp\u003ddhkresult[1];}\n}\nif (contains(link,\"提取码\")\u0026\u0026!contains(openact,\"取消\")){\nvar clink;\nvar runIns;\nclink\u003dlink.split(\" 提取码:\")\nvar action \u003d WriteClipboard.newBuilder()\n    .setText(clink[1])\n    .build();\nshortx.executeAction(action);\nrunIns\u003dclink[0];\n}else{\nrunIns\u003dlink;\n}\nfunction launchWithMode(launchType, input, config, freeformMode, mode, packageName) {\n    \n    var intent;\n\n    if (launchType \u003d\u003d\u003d \"intent\") {\n        intent \u003d Intent.parseUri(input, 0);\n    } else {\n        intent \u003d new Intent(Intent.ACTION_VIEW);\n        intent.setData(Uri.parse(input));\n    }\n\n    if (packageName \u0026\u0026 packageName.trim() !\u003d\u003d \"\") {\n        intent.setPackage(packageName);\n    }\n\n    intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_REORDER_TO_FRONT);\n\n    if (mode \u003d\u003d\u003d \"fullscreen\") {\n        context.startActivity(intent);\n        return \"已全屏启动：\" + (launchType \u003d\u003d\u003d \"intent\" ? \"Intent URI\" : input);\n    }\n\n    var useMode \u003d isAppinstall(\"oplus\") ? 100 : freeformMode;\n    var wm \u003d context.getSystemService(\"window\");\n    var display \u003d wm.getDefaultDisplay();\n    var point \u003d new Point();\n    display.getRealSize(point);\n    var rotation \u003d display.getRotation();\n    var isPortrait \u003d (rotation \u003d\u003d\u003d Surface.ROTATION_0 || rotation \u003d\u003d\u003d Surface.ROTATION_180);\n\n    var width \u003d isPortrait ? parseInt(config[0]) : parseInt(config[1]);\n    var height \u003d parseInt(width / parseFloat(config[2]));\n    var left \u003d isPortrait ? parseInt(config[3]) : parseInt(config[4]);\n    var top \u003d isPortrait ? parseInt(config[5]) : parseInt(config[6]);\n    var right \u003d left + width;\n    var bottom \u003d top + height;\n\n    var options \u003d ActivityOptions.makeBasic();\n    options.setLaunchWindowingMode(useMode);\n    options.setLaunchBounds(new Rect(left, top, right, bottom));\n\n    if (launchType \u003d\u003d\u003d \"intent\") {\n        \n        var UserHandle \u003d android.os.Process.myUserHandle();\ncontext.startActivityAsUser(intent, options.toBundle(), UserHandle);\n    } else {\n        context.startActivity(intent, options.toBundle());\n    }\n\n    return \"已小窗启动：\" + (launchType \u003d\u003d\u003d \"intent\" ? \"Intent URI\" : input);\n}\n\nif(openact!\u003d\"取消\"){\n    switch(openact){\n    case\"跳转\":\n        launchWithMode(\"url\", result, \"\", 0, \"fullscreen\",openapp);\n        break;\n    case\"小窗跳转\":\n        launchWithMode(\"url\",result,outxcpz, outxccs, \"window\",openapp);    \n        break;\n    case\"自适应应用打开\":\n        launchWithMode(\"intent\",runIns, \"\", outxccs, \"fullscreen\",openapp);\n        break;\n    case\"自适应应用打开（小窗）\":\n        launchWithMode(\"intent\",runIns,outxcpz, outxccs, \"window\",openapp);\n        break;\n    case\"浏览器打开\":\n        launchWithMode(\"intent\",runIns, \"\", outxccs, \"fullscreen\",defaultBrowser);\n        break;\n    case\"浏览器打开（小窗）\":\n        launchWithMode(\"intent\",runIns,outxcpz, outxccs, \"window\",defaultBrowser);\n        break;\n    case\"选择应用打开\":\n        var command \u003d ShellCommand.newBuilder()\n    .setCommand(\"am start -d \\\"\"+runIns+\"\\\"\").build();\n    shortx.executeAction(command);\n    break;\n    case\"复制链接\":\n    var action \u003d WriteClipboard.newBuilder()\n    .setText(runIns)\n    .build();\n    shortx.executeAction(action);\n    break;\n    }\n}\n}\n}catch(e){\nerror\u003de.message\n}\n}\nif(isrunaction\u003d\u003dfalse){\n\"打开方式：\"+openact+\"\\n规则命中：\"+ruleapp+\"\\nurlsharme:\"+result+\" \\n跳转规则命中的app：\"+tzapp+\" \\n自适应分配规则命中的app：\"+zsyapp+\" \\n链接：\"+link+\"\\n原始数据：\"+origin+\"\\n默认浏览器：\"+defaultBrowser+\"\\n最终打开的app：\"+openapp+\"\\n运行中的错误：\"+error+\"\\n字符数：\"+charnum+\"\\n自定义跳转规则命中：\"+zdygzmz;}else{\"运行中的错误：\"+error}",
    "context": "CoroutineContext_UI",
    "customContextDataKey": {
      "keys": [{
        "first": "jsRet",
        "second": "jsRet"
      }]
    },
    "note": "All in One",
    "id": "A-23d6f817-759e-4754-8fd6-224fda978dfd"
  }, {
    "@type": "type.googleapis.com/IfThenElse",
    "If": [{
      "@type": "type.googleapis.com/EvaluateContextVar",
      "op": "DoesNotContain",
      "varName": "jsRet",
      "payload": {
        "value": "运行中的错误：undefined"
      },
      "customContextDataKey": {
      },
      "id": "C-da958794-dd3a-40a4-b847-bf08a09a39bb"
    }],
    "IfActions": [{
      "@type": "type.googleapis.com/ShowAlertDialog",
      "positive": "复制日志",
      "onPositive": [{
        "@type": "type.googleapis.com/WriteClipboard",
        "text": "{jsRet}",
        "customContextDataKey": {
        },
        "id": "A-ea62cce2-812e-41a9-a971-c289a1b14901"
      }],
      "neutral": "关闭",
      "title": "错误！",
      "message": "{jsRet}",
      "cancelable": true,
      "style": {
        "fontScale": 1.0
      },
      "customContextDataKey": {
      },
      "id": "A-652ed8ee-f68f-4997-bed1-371ea4b4feff"
    }],
    "customContextDataKey": {
    },
    "id": "A-e520aa5a-a48b-4049-9e05-0dd324fc09dc"
  }],
  "id": "SHARE-rule-4552631c-7a48-4f5f-9685-b923ab2ec5dd",
  "lastUpdateTime": "1753507473725",
  "createTime": "1723386652518",
  "author": {
    "name": "nyehueh"
  },
  "title": "链接流体云2.6",
  "description": "⬆️点击上方图标→执行动作，进入设置页",
  "isEnabled": true,
  "hook": {
    "actionsOnEnabled": [{
      "@type": "type.googleapis.com/ExecuteJS",
      "expression": "importPackage(android.view);\nimportPackage(android.widget);\nimportPackage(android.content);\nimportPackage(android.graphics);\nimportPackage(android.util);\nimportPackage(java.lang);\nimportPackage(android.content.pm);\nimportClass(android.os.Handler);\nimportClass(android.os.Looper);\nimportClass(android.os.UserHandle); \nimportClass(Packages.tornaco.apps.shortx.core.proto.action.ShellCommand);\n\n\nfunction findRandomDirWithPrefix(basePath, prefix) {\n    var File \u003d java.io.File;\n    var dir \u003d new File(basePath);\n    if (!dir.exists() || !dir.isDirectory()) {\n        return null;\n    }\n    var list \u003d dir.listFiles();\n    if (list \u003d\u003d null) {\n        return null;\n    }\n    var result \u003d null;\n    for (var i \u003d 0; i \u003c list.length; i++) {\n        var file \u003d list[i];\n        if (file.isDirectory() \u0026\u0026 file.getName().startsWith(prefix)) {\n            result \u003d file.getName();\n            break; \n        }\n    }\n    return basePath+result;\n}\n\nvar shortxpath\u003dfindRandomDirWithPrefix(\"/data/system/\", \"shortx\");\nfunction roottest() {\n    var path \u003d shortxpath+\"/roottest\";\n    var command \u003d ShellCommand.newBuilder()\n    .setCommand(\"mkdir \"+path).build();\n    shortx.executeAction(command);\n    var File \u003d java.io.File;\n    var dir \u003d new File(path);\n    var result\u003d dir.exists() \u0026\u0026 dir.isDirectory();\n    var command1 \u003d ShellCommand.newBuilder()\n    .setCommand(\"rm -r \"+path).build();\n    shortx.executeAction(command1);\n    return result;\n}\nvar uiClosed \u003d false;\nvar versionName \u003d \"\";\nfunction configversion(path) {\nvar File \u003d java.io.File;\nvar FileInputStream \u003d java.io.FileInputStream;\nvar InputStreamReader \u003d java.io.InputStreamReader;\nvar BufferedReader \u003d java.io.BufferedReader;\n    var file \u003d new File(path);\n    if (!file.exists()) {\n        return 0;\n    }\n    var fis \u003d new FileInputStream(file);\n    var isr \u003d new InputStreamReader(fis, \"UTF-8\");\n    var br \u003d new BufferedReader(isr);\n    br.readLine(); \n    var secondLine \u003d br.readLine(); \n    br.close();\n    return secondLine;\n}\nfunction showCountdowndialogbox(title,text,time){\nfunction runOnUiThread(fn) {\n    new Handler(Looper.getMainLooper()).post(new Runnable({ run: fn }));\n}\n\nrunOnUiThread(function () {\n    var windowManager \u003d context.getSystemService(Context.WINDOW_SERVICE);\n\n    var metrics \u003d new DisplayMetrics();\n    windowManager.getDefaultDisplay().getMetrics(metrics);\n    var screenWidth \u003d metrics.widthPixels;\n    var screenHeight \u003d metrics.heightPixels;\n\n    var layout \u003d new LinearLayout(context);\n    layout.setOrientation(LinearLayout.VERTICAL);\n    layout.setBackgroundColor(Color.TRANSPARENT);\n\n    var backgroundDrawable \u003d new android.graphics.drawable.GradientDrawable();\n    backgroundDrawable.setColor(Color.WHITE);\n    backgroundDrawable.setCornerRadius(50);\n    layout.setBackground(backgroundDrawable);\n    layout.setPadding(40, 40, 40, 40);\n\n    var layoutParams \u003d new WindowManager.LayoutParams(\n        parseInt(screenWidth * 0.9),\n        parseInt(screenHeight * 0.8),\n        WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY,\n        WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL | WindowManager.LayoutParams.FLAG_LAYOUT_IN_SCREEN,\n        PixelFormat.TRANSLUCENT\n    );\n    layoutParams.gravity \u003d Gravity.CENTER;\n\n    var titleView \u003d new TextView(context);\n    titleView.setText(\"使用说明\");\n    titleView.setTextSize(22);\n    titleView.setTextColor(Color.BLACK);\n    titleView.setGravity(Gravity.CENTER);\n    titleView.setPadding(0, 0, 0, 20);\n    layout.addView(titleView);\n\n    var scrollView \u003d new ScrollView(context);\n    var scrollParams \u003d new LinearLayout.LayoutParams(\n        LinearLayout.LayoutParams.MATCH_PARENT,\n        0,\n        1\n    );\n    scrollView.setLayoutParams(scrollParams);\n\n    var textView \u003d new TextView(context);\n    \n    textView.setText(text);\n    textView.setTextSize(18);\n    textView.setTextColor(Color.DKGRAY);\n    textView.setGravity(Gravity.LEFT);\n    scrollView.addView(textView);\n    layout.addView(scrollView);\n\n    var buttonLayout \u003d new LinearLayout(context);\n    buttonLayout.setOrientation(LinearLayout.HORIZONTAL);\n    buttonLayout.setGravity(Gravity.CENTER);\n    buttonLayout.setPadding(0, 30, 0, 0);\n    layout.addView(buttonLayout);\n\n    var closeButton \u003d new Button(context);\n    closeButton.setText(\"下一步 (\"+time+\")\");\n    closeButton.setTextColor(Color.WHITE);\n    closeButton.setEnabled(false);\n\n    function createRoundedDrawable(color) {\n        var drawable \u003d new android.graphics.drawable.GradientDrawable();\n        drawable.setColor(color);\n        drawable.setCornerRadius(30);\n        return drawable;\n    }\n    closeButton.setBackgroundDrawable(createRoundedDrawable(Color.parseColor(\"#BDBDBD\")));\n    buttonLayout.addView(closeButton);\n\n    var secondsRemaining \u003d time;\n    var handler \u003d new Handler();\n    var countdownRunnable \u003d new Runnable({\n        run: function () {\n            secondsRemaining--;\n            if (secondsRemaining \u003e 0) {\n                closeButton.setText(\"下一步 (\" + secondsRemaining + \")\");\n                handler.postDelayed(this, 1000);\n            } else {\n                closeButton.setEnabled(true);\n                closeButton.setText(\"下一步\");\n                closeButton.setBackgroundDrawable(createRoundedDrawable(Color.parseColor(\"#08C661\")));\n            }\n        }\n    });\n    handler.postDelayed(countdownRunnable, 1000);\n\n    closeButton.setOnClickListener(new View.OnClickListener({\n        onClick: function () {\n            if (!closeButton.isEnabled()) return;\n\n            var writeLocalVar \u003d Packages.tornaco.apps.shortx.core.proto.action.WriteLocalVar.newBuilder()\n                .setVarName(\"next\")\n                .setValueAsString(\"true\")\n                .build();\n            shortx.executeAction(writeLocalVar);\n\n            try {\n                windowManager.removeView(layout);\n            } catch (e) {}\n            uiClosed \u003d true;\n        }\n    }));\n\n    try {\n        windowManager.addView(layout, layoutParams);\n    } catch (e) {\n        console.log(\"添加视图失败：\" + e);\n        uiClosed \u003d true;\n    }\n});\nwhile (!uiClosed) {\n    Thread.sleep(200);\n}}\nshowCountdowndialogbox(\"使用说明\",`    0.此指令为自定义UI指令，稳定性与兼容性远不及预制动作制作的指令，如若出现软重启，死机等问题说明你的系统与指令不适配，为确保您的数据安全，请立即停止使用。更新指令与shortx时可能会清理配置，如有自定义的配置，请在更新前做好配置备份，如更新后因配置文件被清理而无法使用，重新开关指令会重新创建默认配置，同时欢迎提交用于各个app的规则\n    \n    1.使用前请确定shell正常\n    (关闭这个对话框后未弹出shell正常toast即为不正常，请确定在shell in systemUI开启时给了systemUI（系统界面）root权限，在未开启时给了shortx root权限)，shell不正常时选择应用打开无效\n    \n    2.小窗打开功能需要没有中转层才可正常使用（如：空浏览,其他浏览器打开等），部分应用可能强制挣脱小窗需求，ColorOS无法使用始终全屏打开时需在指令参数出将小窗参数的值从5改为100(coloros识别机制为oplus应用低版本coloros下可能不存在)\n    \n    3.选中提取功能可能需要手动重命名并选择一下上下文菜单触发器\n    \n    4.流体云单击全屏打开，点击按钮使用小窗打开，顶部时上滑关闭下滑进菜单，底部时上滑进菜单，下滑关闭\n    \n    5.配置文件解释：见配置文件内顶部区域\n    \n    6.点击指令的图标，点击执行动作进入图形化配置页面\n    \n    7.配置文件目录：`+shortxpath+\"/data/copylinkopenapp\",5);\nfunction writeFile(path, content) {\n    importClass(java.io.File);\n    importClass(java.io.FileOutputStream);\n    importClass(java.io.OutputStreamWriter);\n    importClass(java.io.BufferedWriter);\n\n    var file \u003d new File(path);\n    var parent \u003d file.getParentFile();\n    if (!parent.exists()) {\n        parent.mkdirs();\n    }\n\n    var fos \u003d new FileOutputStream(file, false); \n    var writer \u003d new BufferedWriter(new OutputStreamWriter(fos, \"utf-8\"));\n    writer.write(content);\n    writer.close();\n\n    return \"写入成功: \" + path;\n}\nif(configversion(shortxpath+\"/data/copylinkopenapp/config.json\")!\u003d2.4){\nwriteFile(shortxpath+\"/data/copylinkopenapp/config.json\", `一.配置版本：\n2.4\n二.字段解释：\ndjym：顶级域名列表\nemail：邮箱关键词列表\ntqm：提取码关键词列表\nhttpsonly：仅https可用的链接关键词列表（链接无请求头时使用）\nblacklist：链接黑名单关键词列表(注意是链接内的关键词，不是包名)\nxcpz:小窗的大小与位置配置，从左到右依次为竖屏高度 横屏高度 宽高比 竖屏左侧留空 横屏左侧留空 竖屏上侧留空 横屏上侧留空\nxccs：可触发小窗的Windowsmode值，coloros为100(会自动识别，旧版本可能不能识别需要修改为100)，米，类原生为5\nxswz：显示位置（顶部，底部）\nwzpy:位置偏移(向上偏移减小值向下偏移增加值)\nxscs：显示超时时长，超过设定毫秒数无动作浮窗消失\nbrowser:浏览器包名(填自动表示自动识别)\nallowchar:允许出现在链接中的字符\n\n三.配置：\n{\n\"djym\":[\"com\",\"cn\",\"top\",\"love\",\"xyz\",\"net\",\"org\",\"vip\",\"cloud\",\"online\",\"icu\",\"fun\",\"work\",\"tv\",\"wiki\",\"email\",\"plus\",\"co\",\"ltd\",\"shop\",\"tech\",\"wang\",\"site\",\"xin\",\"store\",\"art\",\"cc\",\"website\",\"press\",\"space\",\"beer\",\"luxe\",\"video\",\"group\",\"ren\",\"fit\",\"yoga\",\"pro\",\"ink\",\"info\",\"mobi\",\"kim\",\"red\",\"run\",\"chat\",\"cool\",\"zone\",\"host\",\"biz\",\"me\"],\n\"email\":[\"qq.com\",\"126.com\",\"163.com\",\"139.com\",\"gmail.com\",\"hotmail.com\",\"sohu.com\",\"sina.com\",\"sina.cn\",\"foxmail.com\",\"outlook.com\",\"aliyun.com\",\"tom.com\",\"yeah.net\",\"live.cn\",\"msn.com\"],\n\"tqm\":[\"提取码：\",\"密码：\",\"提取码:\",\"密码:\",\"访问码:\",\"访问码：\",\"提取码 : \"],\n\"httpsonly\":[\"123pan.com\"],\n\"blacklist\":[\"无\"],\n\"xcpz\":[1200,1100,0.6,200,150,400,80],\n\"xccs\":5,\n\"xswz\":\"顶部\",\n\"wzpy\":10,\n\"xscs\":3000,\n\"browser\": \"自动\",\n\"allowchar\": \"qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM#_/-:?%@\u003d.\u0026, ，；;1234567890\"\n}`);}\nif(configversion(shortxpath+\"/data/copylinkopenapp/rules.json\")!\u003d2.5){\nwriteFile(shortxpath+\"/data/copylinkopenapp/rules.json\",`一.配置版本：\n2.5\n二.字段解释：\n1.url类型：\n\"name\":\"百度网盘\",//名称（随意填）\n\"tigger\":[\"pan.baidu.com\"],//触发器(链接包含时触发此条规则)\n\"type\":\"url\",//类型(url：设定此条规则为urlschame规则，pkg：设定此条规则为指定包名规则 注：指定包名规则需应用支持打开才可以，否则会报错)\n\"check\":\"bdnetdisk://\",//检测（填写目标应用可稳定触发的url或包名，检测是否有对应的应用，没有安装此规则对应应用时不触发）\n\"dplink\":\"\\\\/1(.*)\",//自定义的键值对，值为正则字符串(注：因反斜杠在字符串中为转义符，所以正则中有反斜杠需要打双倍个数)，可作为上下文变量放在规则中间使用【键的名称】当占位符，运行时会替换为对应的值说匹配到的值\n\"rule\":\"bdnetdisk://n/action.SHARE_LINK?m_n_v\u003d8.3.0\u0026surl\u003d【dplink】\"//包含自定义上下文变量的完整urlschame，除自定义的上下文变量外【link】表示完整链接【tqm】表示识别到的提取码\n\"rulewithtqm\":\"bdnetdisk://n/action.SHARE_LINK?m_n_v\u003d8.3.0\u0026surl\u003d【dplink】\u0026pwd\u003d【tqm】\"//识别到提取码时的urlschame规则\n\n2.pkg类型：\n\"name\":\"telegram\",//名称（同上）\n\"tigger\":[\"t.me\"],//触发器（同上）\n\"type\":\"pkg\",//设定此条规则为指定应用规则\n\"pkg\":\"tg://\"//填包名或url，用对应的应用打开\n\n\n\n三.规则：\n[{\n\"name\":\"京东\",\n\"tigger\":[\"3.cn\",\"jd.com\"],\n\"type\":\"url\",\n\"check\":\"com.jingdong.app.mall\",\n\"rule\":\"openapp.jdmobile://virtual?params\u003d{\u0027category\u0027:\u0027jump\u0027,\u0027des\u0027:\u0027m\u0027,\u0027url\u0027:\u0027【link】\u0027}\"\n},{\n\"name\":\"百度网盘\",\n\"tigger\":[\"pan.baidu.com\"],\n\"type\":\"url\",\n\"check\":\"com.baidu.netdisk\",\n\"dplink\":\"\\\\\\\\/1(.*)\",\n\"rule\":\"bdnetdisk://n/action.SHARE_LINK?m_n_v\u003d8.3.0\u0026surl\u003d【dplink】\",\n\"rulewithtqm\":\"bdnetdisk://n/action.SHARE_LINK?m_n_v\u003d8.3.0\u0026surl\u003d【dplink】\u0026pwd\u003d【tqm】\"\n},{\n\"name\":\"123网盘\",\n\"tigger\":[\"123pan.com\",\"www.123\"],\n\"type\":\"url\",\n\"check\":\"com.mfcloudcalculate.networkdisk\",\n\"sharekey\":\"\\\\\\\\/s\\\\\\\\/(.*)\",\n\"sharepwd\":\"\\\\\\\\\u0026pwd\u003d(.*)\",\n\"rule\":\"pan://umeng.com/share/list?sharePwd\u003d【sharepwd】\u0026_sdk_\u003dumeng\u0026action\u003dshare_list\u0026shareKey\u003d【sharekey】\",\n\"rulewithtqm\":\"pan://umeng.com/share/list?sharePwd\u003d【tqm】\u0026_sdk_\u003dumeng\u0026action\u003dshare_list\u0026shareKey\u003d【sharekey】\"\n},{\n\"name\":\"淘宝\",\n\"tigger\":[\"tb.cn\"],\n\"type\":\"url\",\n\"check\":\"com.taobao.taobao\",\n\"rule\":\"tbopen://m.taobao.com/tbopen/index.html?h5Url\u003d【link】\"\n},{\n\"name\":\"闲鱼\",\n\"tigger\":[\"tb.cn\"],\n\"type\":\"url\",\n\"check\":\"com.taobao.idlefish\",\n\"rule\":\"fleamarket://2.taobao.com/onepiece?h5Url\u003d【link】\"\n},{\n\"name\":\"阿里云盘\",\n\"tigger\":[\"alipan.com\"],\n\"type\":\"url\",\n\"check\":\"com.alicloud.databox\",\n\"shareid\":\"\\\\\\\\/s\\\\\\\\/(.*)\",\n\"rule\":\"smartdrive://share/browse?shareId\u003d【shareid】\",\n\"rulewithpwd\":\"smartdrive://share/browse?shareId\u003d【shareid】\u0026sharePwd\u003d【tqm】\"\n},{\n\"name\":\"夸克\",\n\"tigger\":[\"pan.quark.cn\"],\n\"type\":\"url\",\n\"check\":\"com.quark.browser\",\n\"rule\":\"qklink://www.uc.cn/b20b84fd735a8dd3f7541129bacc4e9a?action\u003dopen_url\u0026url\u003d【link】\"\n},{\n\"name\":\"1688\",\n\"tigger\":[\"1688.com\"],\n\"type\":\"url\",\n\"check\":\"com.alibaba.wireless\",\n\"rule\":\"wireless1688://ma.m.1688.com/plugin?url\u003d【link】\"\n},{\n\"name\":\"百度贴吧\",\n\"tigger\":[\"tieba.baidu.com\"],\n\"type\":\"url\",\n\"tid\":\"/\\\\\\\\/p\\\\\\\\/(.*?)(\\\\\\\\?|$)/\",\n\"check\":\"com.baidu.tieba\",\n\"rule\":\"com.baidu.tieba://unidispatch/pb?tid\u003d【tid】\"\n},{\n\"name\":\"库街区\",\n\"tigger\":[\"kurobbs.com\"],\n\"type\":\"url\",\n\"check\":\"com.kurogame.kjq\",\n\"postid\":\"\\\\\\\\?postId\u003d(.*)\",\n\"rule\":\"kjq://home/post/postDetail?postId\u003d【postid】\"\n},{\n\"name\":\"快手\",\n\"tigger\":[\"kuaishou.com\"],\n\"type\":\"url\",\n\"check\":\"com.smile.gifmaker\",\n\"rule\":\"kwai://webview?url\u003d【link】\"\n},{\n\"name\":\"小红书\",\n\"tigger\":[\"xhslink.com\"],\n\"type\":\"url\",\n\"check\":\"com.xingin.xhs\",\n\"rule\":\"xhsdiscover://item/6809ccfd000000001a007525?open_url\u003d【link】\"\n},{\n\"name\":\"米游社\",\n\"tigger\":[\"miyoushe.com\"],\n\"type\":\"url\",\n\"check\":\"mihoyobbs://\",\n\"rule\":\"mihoyobbs://webview?link\u003d【link】\"\n},{\n\"name\":\"115\",\n\"tigger\":[\"115cdn.com\"],\n\"type\":\"url\",\n\"check\":\"oof.disk://\",\n\"rule\":\"oof.disk://openurl/【link】?password\u003d【tqm】\"\n},{\n\"name\":\"telegram\",\n\"tigger\":[\"t.me\"],\n\"type\":\"pkg\",\n\"pkg\":\"tg://\"\n},{\n\"name\":\"新浪微博\",\n\"tigger\":[\"weibo.com\"],\n\"type\":\"pkg\",\n\"pkg\":\"com.sina.weibo\"\n},{\n\"name\":\"酷安\",\n\"tigger\":[\"coolapk.com\"],\n\"type\":\"pkg\",\n\"pkg\":\"com.coolapk.market\"\n},{\n\"name\":\"抖音\",\n\"tigger\":[\"douyin.com\"],\n\"type\":\"pkg\",\n\"pkg\":\"com.ss.android.ugc.aweme\"\n},{\n\"name\":\"拼多多\",\n\"tigger\":[\"yangkeduo.com\",\"y4n.cn\",\"srgnnmsrg.com\",\"pinduoduo.com\"],\n\"type\":\"pkg\",\n\"pkg\":\"com.xunmeng.pinduoduo\"\n},{\n\"name\":\"哔哩哔哩\",\n\"tigger\":[\"bilibili.com\",\"b23.tv\",\"bilibili.cn\",\"bilibili.tv\",\"bili22.cn\",\"bili23.cn\",\"bili33.cn\",\"m.acg.tv\",\"bili2233.cn\",\"bilibili.smgbb.cn\"],\n\"type\":\"pkg\",\n\"pkg\":\"tv.danmaku.bili\"\n}]\n`);}\nvar islowversion\u003dfalse;\ntry{\nconsole.log(\"版本检测通过\");\n}catch(e){\nislowversion\u003dtrue;\n}\nvar hjts\u003d\"\";\nif(!roottest()){\nhjts\u003d\"shell异常：\\n请确定在shell in systemUI开启时给了systemUI（系统界面）root权限，在未开启时给了shortx root权限，Magisk用户如无法弹出授权提示框，关闭shamiko并重启即可弹出。shell异常不影响主要功能使用，若无法使shell正常可忽略，选择应用打开功能将不可用。\\n\";\n}\nif(islowversion){\nhjts\u003dhjts+\"ShortX版本过低：\\n请更新到最新版本后使用。\";\n}\nif(hjts!\u003d\"\"){\nshowCountdowndialogbox(\"环境异常\",hjts,3);\n}",
      "context": "CoroutineContext_UI",
      "customContextDataKey": {
      },
      "note": "倒计时对话框（使用说明）\n初始化配置文件",
      "id": "A-0feb5e8c-96b5-4f32-a35b-ed94ae93745d"
    }]
  },
  "quit": {
  },
  "versionCode": "1",
  "ruleInstanceIdGenerator": {
    "@type": "type.googleapis.com/RuleInstanceIdGenerator_String",
    "insId": "{clipboardContent}{selectedText}"
  }
}
###------###
{"type":"rule"}